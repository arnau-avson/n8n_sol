<!DOCTYPE html>
<html lang="es">
    <head>
    <meta charset="UTF-8">
    <title>Análisis Técnico</title>
    <style>
        body {
        font-family: Arial, sans-serif;
        padding: 20px;
        background: #f5f5f5;
        }
        button {
        padding: 10px 20px;
        font-size: 16px;
        cursor: pointer;
        margin-bottom: 20px;
        }
        .section {
        background: #fff;
        padding: 15px;
        margin-bottom: 15px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .section h2 {
        margin-top: 0;
        color: #333;
        }
        .section ul {
        list-style-type: none;
        padding-left: 0;
        }
        .section ul li {
        margin: 5px 0;
        }
    </style>
    </head>
    <body>

    <button onclick="obtenerDatos()">Obtener análisis técnico</button>

    <div id="resultado"></div>

    <script>
        async function obtenerDatos() {
        const url = 'http://localhost:5678/webhook/45ec9f4b-c579-42f3-84db-cd4d9267b647';

        try {
            const respuesta = await fetch(url);
            const data = await respuesta.json();

            const texto = data.parts?.[0]?.text || '';
            const secciones = parsearTexto(texto);

            mostrarDatos(secciones);
        } catch (error) {
            document.getElementById('resultado').innerHTML = `<p>Error al obtener datos: ${error}</p>`;
        }
        }

        function parsearTexto(texto) {
            const bloques = texto.split(/\n\n/);
            const resultado = {};

            bloques.forEach(bloque => {
                const lineas = bloque.split('\n').filter(Boolean);
                if (lineas.length === 0) return;
                const titulo = lineas[0].replace(/:$/, '').replace(/_/g, ' ');
                const datos = lineas.slice(1).map(linea => {
                    const [clave, valor] = linea.split(':');
                    let val = valor ? valor.trim() : '';
                    // Si el valor está entre corchetes, mostrar como lista
                    if (/^\[.*\]$/.test(val)) {
                        val = val.replace(/^\[|\]$/g, '').split(',').map(v => v.trim()).filter(Boolean);
                    }
                    return { clave: clave ? clave.replace(/_/g, ' ').trim() : '', valor: val };
                });
                resultado[titulo.trim()] = datos;
            });
            return resultado;
        }

        function mostrarDatos(secciones) {
            const contenedor = document.getElementById('resultado');
            contenedor.innerHTML = '';

            for (const [titulo, items] of Object.entries(secciones)) {
                const div = document.createElement('div');
                div.className = 'section';

                const h2 = document.createElement('h2');
                h2.textContent = titulo;
                div.appendChild(h2);

                const ul = document.createElement('ul');
                items.forEach(({ clave, valor }) => {
                    const li = document.createElement('li');
                    if (Array.isArray(valor)) {
                        li.innerHTML = `<strong>${clave}:</strong> <ul style='margin:0 0 0 1em;padding:0;'>${valor.map(v => `<li>${v}</li>`).join('')}</ul>`;
                    } else {
                        li.innerHTML = `<strong>${clave}:</strong> ${valor}`;
                    }
                    ul.appendChild(li);
                });

                div.appendChild(ul);
                contenedor.appendChild(div);
            }
        }
    </script>
    </body>
</html>
